{% extends "base.html" %}

{% block header %}Instagram Login (Manual){% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- Session ID Management -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fab fa-instagram me-2"></i>Session ID Management
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Session ID Login:</strong> This method bypasses 2FA completely and is the most reliable way to keep the bot logged in.
                </div>
                
                <form method="POST" action="{{ url_for('update_instagram_login') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">
                            Instagram Username
                            <i class="fas fa-lock text-muted ms-1" title="Read-only - set via environment variables"></i>
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="username" 
                               value="{{ login.username or 'Not configured' }}" 
                               readonly>
                        <div class="form-text">
                            This is read-only. Username is set via INSTAGRAM_USERNAME environment variable.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="session_id" class="form-label">
                            Instagram Session ID
                            <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control font-monospace" 
                                  id="session_id" 
                                  name="session_id" 
                                  rows="3" 
                                  placeholder="Paste your Instagram session ID here..."
                                  required></textarea>
                        <div class="form-text">
                            {% if login.has_session_id %}
                                <span class="text-success">
                                    <i class="fas fa-check-circle me-1"></i>
                                    Current session ID: {{ login.session_id_preview }}
                                </span>
                            {% else %}
                                <span class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    No session ID configured
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Update Session ID
                        </button>
                        {% if login.has_session_id %}
                        <button type="button" class="btn btn-outline-secondary" onclick="testLogin()">
                            <i class="fas fa-flask me-1"></i>Test Login
                        </button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Try Professional Method -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-star me-2"></i>Recommended: Professional Login
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success" role="alert">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Easier Method Available:</strong> Try our professional OAuth login that works just like Sprout Social!
                </div>
                <a href="/instagram-login-pro" class="btn btn-success">
                    <i class="fab fa-instagram me-1"></i>Try Professional Login
                </a>
            </div>
        </div>
    </div>
    
    <!-- Help Section -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-question-circle me-2"></i>How to Get Session ID
                </h5>
            </div>
            <div class="card-body">
                <div class="small">
                    <h6 class="text-primary">Step-by-Step Guide:</h6>
                    <ol>
                        <li><strong>Open Instagram:</strong> Go to <a href="https://instagram.com" target="_blank">instagram.com</a> in your browser</li>
                        <li><strong>Login:</strong> Login to your Instagram account normally</li>
                        <li><strong>Open Developer Tools:</strong> Press <kbd>F12</kbd> or right-click → Inspect</li>
                        <li><strong>Go to Application:</strong> Click the "Application" tab</li>
                        <li><strong>Find Cookies:</strong> Expand "Cookies" → "https://www.instagram.com"</li>
                        <li><strong>Copy Session ID:</strong> Find "sessionid" and copy its Value</li>
                        <li><strong>Paste Here:</strong> Paste the session ID in the form above</li>
                    </ol>
                    
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-clock me-1"></i>
                        <strong>Session Expiry:</strong> Session IDs typically last 1-3 months. You'll need to update it when it expires.
                    </div>
                    
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-shield-alt me-1"></i>
                        <strong>Security:</strong> This method is safer than using username/password and bypasses 2FA completely.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>Troubleshooting
                </h5>
            </div>
            <div class="card-body">
                <div class="small">
                    <h6 class="text-warning">Common Issues:</h6>
                    <ul>
                        <li><strong>Session Expired:</strong> Get a new session ID following the steps above</li>
                        <li><strong>Invalid Format:</strong> Session IDs are long strings (usually 30+ characters)</li>
                        <li><strong>Copy Error:</strong> Make sure you copied the entire session ID value</li>
                        <li><strong>Wrong Account:</strong> Ensure you're logged into the correct Instagram account</li>
                    </ul>
                    
                    <div class="mt-3">
                        <a href="{{ url_for('logs_page') }}" class="btn btn-outline-warning btn-sm">
                            <i class="fas fa-file-alt me-1"></i>View Logs
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function testLogin() {
    fetch('/run-once', { method: 'POST' })
        .then(response => {
            if (response.ok) {
            alert('✅ Test login started! Check the logs page for results.');
            window.location.href = '/logs';
            } else {
            alert('❌ Failed to start test login');
            }
        })
        .catch(error => {
            alert('❌ Error: ' + error);
        });
}
</script>
{% endblock %} 